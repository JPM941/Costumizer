
<div class="container mt-4">

  <div class="d-flex mb-4">
    <div>
      <% if @costume.images.attached? %>
        <% @costume.images.each do |image| %>
          <%= cl_image_tag image.key, height: 400, width: 400, crop: :fill %>
        <% end %>
      <% end %>
    </div>

    <div class="m-4">
      <h2><%= "#{@costume.name}" %></h2>
      <h3><%= "#{@costume.price}" %>â‚¬ / day</h2>
      <% if @costume.bookings.empty? %>
        <% @note ||= 0 %>
          <% @costume.bookings.each do |booking|%>
          <% @note += booking.review.rating %>
          <% end %>
        <%= "#{@note / @costume.bookings.length} / 5" %>
      <% end %>

      <p>This wonderful costume is offered by <%= "#{@costume.user.user_name}" %> !</p>
      <%= link_to "Book this costume", new_costume_booking_path(@costume), class: "btn-flat"%>
      <% if current_user %>
        <% unless Bookmark.where({user: current_user, costume: @costume}).any? %>
          <%= link_to costume_bookmarks_path(@costume),data: {turbo_method: :post}, class:"text-decoration-none btn-flat" do %>
            <i class="fas fa-heart"></i> Add to favorite
          <% end %>
        <% else %>
          <%= link_to bookmark_path(Bookmark.where({user: current_user, costume: @costume}).first),data: {turbo_method: :delete}, class:"text-decoration-none btn-flat" do %>
            <i class="fas fa-heart"></i> Remove from favorite
          <% end %>
        <% end %>

      <% end %>
    </div>
  </div>



  <p style="text-align: justify"><%= "#{@costume.description}" %></p>

    <% if current_user == @costume.user %>
      <%= link_to "Edit", edit_costume_path(@costume), class: "btn-flat"%>
      <%= link_to "Delete",
          costume_path(@costume),
          class: "btn-flat",
          data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}
        %>
    <% end %>

  <div class="map-comment-grid">
    <div>
      <h2 class="mt-4">Reviews</h2>
        <% @costume.reviews.each do |review| %>
          <div class="review-card">
            <p class="pt-3">Posted by USERNAME<p>
            <% (1..review.rating).to_a.each do |star| %>
              <i class="fa-solid fa-star active"></i>
            <% end %>
            <p class="mt-3 pb-3"><%= review.content %></p>
          </div>
        <% end %>
      </ul>
    </div>

    <div>
      <h2 class="mt-4">Costume's location</h2>
      <div style="width: 100%; height: 300px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>
    </div>

  </div>


</div>
<p><strong>Reviews</strong></p>
<ul class="list-group">
  <% @costume.bookings.each do |booking|%>
    <li class="list-group-item"><%= booking.review.content %></li>
    <li class="list_group_item"><%= "#{booking.review.rating}/5"%>
  <% end %>
</ul>
<br>
